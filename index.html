<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PriceWatch — Compare Local Prices</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6fbff;
    --card:#ffffff;
    --accent:#00b894;
    --accent2:#0984e3;
    --muted:#6c7a89;
    --glass: rgba(255,255,255,0.7);
  }
  *{box-sizing:border-box;font-family:"Poppins",system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:linear-gradient(180deg,#e9f7ff 0%,var(--bg) 50%);color:#123;}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px;background:rgba(255,255,255,0.6);backdrop-filter:blur(6px);position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(0,0,0,0.04)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;box-shadow:0 4px 14px rgba(9,132,227,0.18)}
  nav a{margin:0 10px;color:var(--muted);text-decoration:none;font-weight:600;font-size:14px}
  nav a.active{color:#0b3b5a}
  .container{max-width:1080px;margin:28px auto;padding:0 20px}
  .hero{display:grid;grid-template-columns:1fr 420px;gap:24px;align-items:center}
  .card{background:var(--card);border-radius:14px;padding:22px;box-shadow:0 10px 30px rgba(15,36,63,0.04)}
  h1{margin:0 0 8px;font-size:28px}
  p.lead{margin:0;color:var(--muted)}
  .searchbox{display:flex;gap:10px;margin-top:18px}
  input.search{flex:1;padding:12px 14px;border-radius:10px;border:1px solid #e6eef6;font-size:15px}
  button.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:white;padding:12px 16px;border-radius:10px;font-weight:700;cursor:pointer}
  .small{font-size:13px;color:var(--muted)}
  .stats{display:flex;gap:12px;margin-top:16px}
  .stat{flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.9),var(--glass));padding:12px;border-radius:10px;text-align:center}
  .stat strong{display:block;font-size:18px;color:#092a3a}
  .mapcard{height:360px;border-radius:12px;overflow:hidden}
  .section{margin-top:26px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;text-align:left;border-bottom:1px dashed #eef6fb}
  th{color:var(--muted);font-weight:700}
  tr.cheapest{background:linear-gradient(90deg,rgba(0,184,148,0.06),rgba(9,132,227,0.03))}
  footer{margin:48px 0 80px;text-align:center;color:var(--muted);font-size:14px}
  /* responsive */
  @media(max-width:920px){.hero{grid-template-columns:1fr;}.mapcard{height:260px}}
  .pill{display:inline-block;background:rgba(9,132,227,0.08);color:var(--accent2);padding:4px 8px;border-radius:999px;font-weight:700;font-size:13px}
  .store-badge{font-size:12px;padding:6px 10px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.06)}
  .hint{font-size:13px;color:#3b5666}
  /* nav mobile */
  .nav-right{display:flex;gap:10px;align-items:center}
  .link-muted{color:var(--muted);font-weight:600}
  .logo-text{font-weight:700;color:#073642}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">PW</div>
    <div>
      <div class="logo-text">PriceWatch</div>
      <div style="font-size:12px;color:var(--muted)">Compare local prices instantly</div>
    </div>
  </div>
  <nav>
    <a href="#home" class="active">Home</a>
    <a href="#compare">Compare Prices</a>
    <a href="#stores">Stores</a>
    <a href="#how">How It Works</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
  </nav>
  <div class="nav-right">
    <a class="link-muted" href="/mnt/data/Ecoblock Project.pdf" target="_blank" title="Project PDF">Project PDF</a>
    <button class="btn" onclick="scrollToSection('#compare')">Compare</button>
  </div>
</header>

<div class="container">
  <section id="home" class="hero">
    <div>
      <div class="card">
        <h1>Find the best local price—fast.</h1>
        <p class="lead">PriceWatch helps you compare everyday prices across nearby stores like Alfamart, 7-Eleven, Dali, and more. Save money, save time.</p>
        <div class="searchbox">
          <input id="productInput" class="search" placeholder="Search product (e.g., rice, eggs, milk)" />
          <button class="btn" onclick="doCompare()">Compare</button>
        </div>
        <div class="stats">
          <div class="stat">
            <span class="small">Nearby stores</span>
            <strong id="nearbyCount">—</strong>
            <span class="small">Auto-detected</span>
          </div>
          <div class="stat">
            <span class="small">Products in DB</span>
            <strong id="productCount">—</strong>
            <span class="small">Editable locally</span>
          </div>
          <div class="stat">
            <span class="small">Coverage</span>
            <strong>Local (Barangay)</strong>
            <span class="small">Use geolocation</span>
          </div>
        </div>
        <p class="hint" style="margin-top:12px">Tip: allow location for best results. If denied, enter lat/lon manually in the Compare page.</p>
      </div>

      <div class="section card" style="margin-top:16px">
        <h3 style="margin:0 0 8px">Latest price checks</h3>
        <div id="latestList" class="small">No searches yet — try a product above.</div>
      </div>
    </div>

    <div>
      <div class="card mapcard" id="mapcard">
        <iframe id="miniMap" style="border:0;width:100%;height:100%" srcdoc="<html><body style='display:flex;align-items:center;justify-content:center;height:100%;font-family:Arial;color:#3b5666'>Allow location and use Compare to show nearby stores.</body></html>"></iframe>
      </div>
    </div>
  </section>

  <section id="compare" class="section">
    <div class="card">
      <h2>Compare Prices</h2>
      <p class="small">Search a product and see prices at nearby stores. You can also enter your coordinates manually.</p>
      <div style="display:flex;gap:12px;margin-top:10px;flex-wrap:wrap">
        <input id="searchProduct" placeholder="Product name (e.g., rice, eggs, milk)" style="padding:10px;border-radius:8px;border:1px solid #eaf4fb;flex:1" />
        <input id="coords" placeholder="Your coords (lat,lon) — optional" style="padding:10px;border-radius:8px;border:1px solid #eaf4fb;width:220px" />
        <button class="btn" onclick="compareFromUI()">Compare</button>
      </div>

      <div id="resultArea" style="margin-top:14px"></div>
    </div>
  </section>

  <section id="stores" class="section">
    <div class="card">
      <h2>Stores</h2>
      <p class="small">List of demo stores in the database. Edit the script to add real stores and actual coordinates.</p>
      <table id="storesTable" style="margin-top:10px">
        <thead><tr><th>Store</th><th>Type</th><th>Address</th><th>Distance</th><th>Map</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="how" class="section">
    <div class="card">
      <h2>How It Works</h2>
      <ol>
        <li>We detect your location (or use manual coords)</li>
        <li>You search a product (e.g., rice)</li>
        <li>The site looks up product prices from our stores dataset</li>
        <li>We compute distance and show nearest stores, sorted by distance</li>
        <li>The cheapest price is highlighted so you can save</li>
      </ol>
    </div>
  </section>

  <section id="about" class="section">
    <div class="card">
      <h2>About PriceWatch</h2>
      <p class="small">PriceWatch is a community-focused price comparator to help households find the cheapest basic goods nearby. It is designed as a lightweight, privacy-friendly web tool that works on phones and desktops.</p>
      <p class="small">Data is crowdsourced — users or local volunteers can update prices to keep the site accurate.</p>
    </div>
  </section>

  <section id="contact" class="section">
    <div class="card">
      <h2>Contact</h2>
      <p class="small">For questions or to contribute data, email <strong>hello@pricewatch.ph</strong> (demo).</p>
      <p class="small">Project file: <a href="/mnt/data/Ecoblock Project.pdf" target="_blank">/mnt/data/Ecoblock Project.pdf</a></p>
    </div>
  </section>

  <footer>
    © PriceWatch — Local price comparison demo • Built for classroom & community use.
  </footer>
</div>

<script>
/* -----------------------
  Demo data — edit here
------------------------*/
const STORES = [
  // sample coordinates in Metro Manila (replace with real ones)
  { id:1, name:"Alfamart – Greenway", type:"Alfamart", address:"Greenway, Sampaloc", lat:14.6110, lon:120.9920,
    prices:{ rice:55.00, eggs:80.00, milk:62.00, "canned tuna":35.00 } },
  { id:2, name:"7-Eleven – Mabini", type:"7-Eleven", address:"Mabini St., Malate", lat:14.5839, lon:120.9847,
    prices:{ rice:59.00, eggs:85.00, milk:68.00, "canned tuna":39.00 } },
  { id:3, name:"Dali Mart – Plaza", type:"Dali Mart", address:"Plaza Rd., QC", lat:14.6378, lon:121.0283,
    prices:{ rice:54.50, eggs:81.00, milk:60.00, "canned tuna":34.50 } },
  { id:4, name:"Neighborhood Grocer", type:"Local Grocer", address:"Barangay Hall St.", lat:14.6200, lon:120.9950,
    prices:{ rice:56.00, eggs:78.00, milk:65.00, "canned tuna":36.00 } }
];

const ALL_PRODUCTS = Array.from(new Set(STORES.flatMap(s=>Object.keys(s.prices))));
/* -----------------------
  Utility functions
------------------------*/
function haversine(lat1,lon1,lat2,lon2){
  const R = 6371; // km
  const toRad = v => v*Math.PI/180;
  const dLat = toRad(lat2-lat1), dLon = toRad(lon2-lon1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  const c = 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  return R*c;
}

/* -----------------------
 Initialize UI
------------------------*/
document.getElementById('productCount').textContent = ALL_PRODUCTS.length;
document.getElementById('storesTable').querySelector('tbody').innerHTML = STORES.map(s=>{
  return `<tr><td><strong>${s.name}</strong></td><td>${s.type}</td><td>${s.address}</td><td id="dist-${s.id}">—</td><td><a target="_blank" href="https://www.google.com/maps/search/?api=1&query=${s.lat},${s.lon}">Map</a></td></tr>`;
}).join('');

let lastSearches = [];
function updateLatest(text){
  lastSearches.unshift({t: new Date(), text}); if(lastSearches.length>6) lastSearches.pop();
  document.getElementById('latestList').innerHTML = lastSearches.map(s=>`<div style="padding:6px 0;border-bottom:1px solid #f2f8fb">${s.text} <span style="color:#7a8b96;font-size:12px">• ${new Date(s.t).toLocaleTimeString()}</span></div>`).join('');
}

/* -----------------------
  Geolocation & compare
------------------------*/
let userPos = null;
function tryGetLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      userPos = {lat: pos.coords.latitude, lon: pos.coords.longitude};
      document.getElementById('nearbyCount').textContent = STORES.length;
      // update store distances shown in stores table
      STORES.forEach(s=>{
        const d = (haversine(userPos.lat,userPos.lon,s.lat,s.lon)).toFixed(2);
        const el = document.getElementById(`dist-${s.id}`); if(el) el.textContent = d+' km';
      });
      // update map with markers
      showMap(userPos.lat,userPos.lon);
    }, err=>{
      console.warn('Geolocation denied or failed', err);
      userPos = null;
      document.getElementById('nearbyCount').textContent = STORES.length + ' (manual coords available)';
    });
  } else {
    document.getElementById('nearbyCount').textContent = STORES.length;
  }
}
tryGetLocation();

function showMap(lat,lon){
  // simple static embedded Google Maps URL for preview - uses srcdoc fallback
  const mapUrl = `https://www.google.com/maps?q=${lat},${lon}&z=14&output=embed`;
  document.getElementById('miniMap').src = mapUrl;
}

/* Compare logic */
function compareFromUI(){
  const prod = (document.getElementById('searchProduct').value || '').trim().toLowerCase();
  const coords = (document.getElementById('coords').value || '').trim();
  if(!prod){ alert('Type a product name (e.g., rice)'); return; }
  let lat=null, lon=null;
  if(coords){
    const parts = coords.split(',').map(s=>parseFloat(s.trim()));
    if(parts.length===2 && !isNaN(parts[0]) && !isNaN(parts[1])){ lat=parts[0]; lon=parts[1]; userPos={lat,lon}; showMap(lat,lon);}
    else { alert('Coordinates must be "lat,lon"'); return; }
  } else if(!userPos){
    // fallback prompt
    const manual = prompt('Enter your coordinates as lat,lon (e.g., 14.6,121.0) to calculate nearest stores:');
    if(!manual) return;
    const p = manual.split(',').map(s=>parseFloat(s.trim()));
    if(p.length===2 && !isNaN(p[0]) && !isNaN(p[1])){ userPos={lat:p[0],lon:p[1]}; showMap(p[0],p[1]); } else { alert('Invalid coords'); return; }
  }
  doCompare(prod);
}

function doCompare(productName){
  const prod = (productName || document.getElementById('productInput').value || document.getElementById('searchProduct').value || '').trim().toLowerCase();
  if(!prod) { alert('Please enter product name'); return; }
  updateLatest(prod);
  // find stores that have the product
  const found = STORES.filter(s=>s.prices && Object.keys(s.prices).map(k=>k.toLowerCase()).includes(prod));
  // compute distance, price, sort by distance
  const enriched = found.map(s=>{
    const price = s.prices[Object.keys(s.prices).find(k=>k.toLowerCase()===prod)];
    const dist = userPos ? haversine(userPos.lat,userPos.lon,s.lat,s.lon) : null;
    return {...s,price,dist};
  }).sort((a,b)=>{
    if(a.dist==null) return 0;
    return a.dist - b.dist;
  });
  renderResults(prod,enriched);
}

function renderResults(prod,enriched){
  const area = document.getElementById('resultArea');
  if(enriched.length===0){
    area.innerHTML = `<div class="card"><p class="small">No stores in the database currently list <strong>${prod}</strong>. You can add data in the script or ask a local volunteer to update prices.</p></div>`;
    return;
  }
  // build table
  let rows = enriched.map((s,idx)=>{
    const distText = s.dist!=null ? (s.dist.toFixed(2)+' km') : '—';
    const mapLink = `<a target="_blank" href="https://www.google.com/maps/search/?api=1&query=${s.lat},${s.lon}">Map</a>`;
    return `<tr class="${idx===0 && enriched.reduce((p,c)=> c.price < p.price ? c : p, enriched[0])===s ? 'cheapest' : ''}">
      <td><strong>${s.name}</strong><div class="small">${s.type} • ${s.address}</div></td>
      <td>₱ ${s.price.toFixed(2)}</td>
      <td>${distText}</td>
      <td>${mapLink}</td>
    </tr>`;
  }).join('');
  // highlight cheapest by compute
  const cheapestPrice = Math.min(...enriched.map(e=>e.price));
  rows = enriched.map((s)=>{
    const isCheap = s.price === cheapestPrice;
    return `<tr class="${isCheap? 'cheapest' : ''}">
      <td><strong>${s.name}</strong><div class="small">${s.type} • ${s.address}</div></td>
      <td>₱ ${s.price.toFixed(2)} ${isCheap? '<span style="color:var(--accent2);font-weight:700;margin-left:8px">Cheapest</span>' : ''}</td>
      <td>${s.dist!=null? s.dist.toFixed(2)+' km':'—'}</td>
      <td><a target="_blank" href="https://www.google.com/maps/search/?api=1&query=${s.lat},${s.lon}">Map</a></td>
    </tr>`;
  }).join('');

  area.innerHTML = `
    <div class="card">
      <h3 style="margin-top:0">Results for "<span class="pill">${prod}</span>"</h3>
      <p class="small">Showing ${enriched.length} store(s) — sorted by distance (if available).</p>
      <table style="margin-top:12px">
        <thead><tr><th>Store</th><th>Price</th><th>Distance</th><th>Map</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
    </div>
  `;
}

/* helper to scroll */
function scrollToSection(id){
  const el = document.querySelector(id);
  if(el) el.scrollIntoView({behavior:'smooth',block:'start'});
}

/* quick compare trigger */
function doCompare(){ doCompare(document.getElementById('productInput').value.trim().toLowerCase()); }
</script>
</body>
</html>
